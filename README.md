# Static website dockerisation #

This repo is a simple skeleton for building static websites using Docker. The tools are designed to be able to launch a website with ssl support by running a series of simple bash scripts. Everything is also encompassed inside a docker container meaning it is platform agnostic, so long as you have Docker installed.

Please note I made this mostly for myself so things will not be 100% perfect or necessarily very good since I only made everything good enough to suit my purposes.

## Instructions ##

1. The first thing you need to do is purchase a domain. This can be done from providers like godaddy and namecheap.
2. Next you will need to gain access to a machine with a static IP address. In my case I used digital ocean and purchased the smallest droplet available to me however if you are expecting more traffic you could try using a larger VM or looking into AWS/Azure cloud hosting. If you have a machine with a static IP you may also host on your own machine. Such is the beauty of Docker
3. Link your domain to your IP. This will have to be done through your domain provider. You will need to point the domain you purchased to the IP of the machine you are hosting on. The means of doing this is outside the scope of this readme but remember you will need a 'A' record, a 'AAAA' record so that your site can be accessed via http://domain.com and you will need a 'CNAME' record so that your site can be accessed via www.domain.com. See your domain providers documentation for help with this
4. Clone this repo to your host machine
5. Generate dummy certificates. This means running make_dummies.sh which will create self signed ssl certificates in ssl_stuff/certs. These are temporary certificates which are intended to be used for initial setup before certbot has registered your site with the EFF.
6. Change all the domains and email addresses in the repo to match those for your site (you need to replace domain.com and you@email.com). You can also change the name of the container your site will be run in (currently `simple-site`). These changes need to be made in
* conf/nginx.conf
* run_certbot.sh
* run_website.sh
7. Put your website into 'static-html-directory. If you change the location of your 404 page you will also need to change the location in nginx.conf
8. Run `run_website.sh` this should build the docker container and run the certbot to make sure everything is up and running. After this you should be good to go. Check your website in your browser to make sure everything worked right.


## Common problems ###

* `Certbot went wrong`: If when you go to your site in the browser you see a warning about unsigned certificates it may well be that the certbot didn't work right. Check the output when you started your site
* `Website won't start`: If the docker image won't start it may be that you are missing the dummy certificates. Make sure that ssl_stuff/certs contains both `ca-certificates.crt` and `mykey.pem`, generated by `make_dummies.sh`.

## Warnings ##

* Do not try multiple times to generate ssl certificates when it worked already. You will get a week long ban. If you need to shut down the site and reboot it the bash scripts are designed to check if there are certificates already and should not re-register them if they are already present. Keep an eye on the print out when you start the website.
* Try to use alpine docker containers when you can. They're massively smaller. This is kind of irrelivent if you are just using this out of the box but if you want to develop this further its something to keep in mind.
* Everything to do with ssl is a massive pain. This is just a lesson I learned whilst trying to get this all working.